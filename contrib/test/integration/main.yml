- hosts: all
  remote_user: root
  vars_files:
    - "{{ playbook_dir }}/vars.yml"
  tasks:
    - name: Set up the system
      include: system.yml
      tags:
        - setup

    - name: Build CRI-O
      include: cmdrunner.yml tags=build
      tags:
        - always

    - block:
        - name: Install CRI-O
          include: cmdrunner.yml tags=install

        - name: Smoke test Installed CRI-O
          include: cmdrunner.yml tags=smoke

        - name: Execute Kubernetes e2e tests
          include: e2e.yml

      # Just fudging past origin-ci use of tags
      tags:
        - e2e
