---

- name: These only run on RedHat-ish systems (for now)
  assert:
    that:
        - 'ansible_distribution in ["RedHat", "Fedora"]'
        - 'artifacts is defined'
        - 'cri_o_dest_path | default("", True) | trim | length'

- name: Directory exists for build output
  file:
    path: "{{ artifacts }}"
    state: directory

- name: Commands executed for building RPM
  shell: |
    set -ex;
    (
        cd "{{ cri_o_dest_path }}";
        yum-builddep -y cri-o-testonly.spec;
        make test-rpm;
    ) 2>&1 | tee -a {{ artifacts }}/rpmbuild.txt;
