---

- name: These only run on RedHat-ish systems (for now)
  assert:
    that:
        - 'ansible_distribution in ["RedHat", "Fedora"]'
        - 'artifacts is defined'
        - 'cri_o_dest_path | default("", True) | trim | length'

- name: Directory exists for install output
  file:
    path: "{{ artifacts }}"
    state: directory

- name: Execute command for installing RPM
  shell: |
    set -ex;
    (
        cd "{{ cri_o_dest_path }}";
        rm -f *.src.rpm;
        $(type -P dnf || type -P yum) install -y $(find -name '*.rpm');
    ) 2>&1 | tee -a {{ artifacts }}/rpminstall.txt;
